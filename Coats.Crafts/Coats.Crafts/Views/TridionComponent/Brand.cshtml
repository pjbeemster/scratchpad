@using DD4T.ContentModel;
@using Coats.Crafts.Extensions;

@model IComponentPresentation

@{
	Layout = null;

	// Overwrite default span declaration for pods - removes width styling
	ViewBag.PodGenericSpan = "span3";

    IField logo = null;
    string link = null;
    string target = "";
    
	var fields = @Model.Component.Fields;
	var linkedKeywordFields = fields.ContainsKey("title") ? fields["title"].Keywords[0].MetadataFields : null;
    var body = fields.ContainsKey("body") ? fields["body"].Values : null;
    var banner = fields.ContainsKey("banner") ? fields["banner"] : null;
    var related = fields.ContainsKey("related") ? fields["related"].EmbeddedValues : null;
    
    if (linkedKeywordFields != null)
    {
	    logo = linkedKeywordFields.ContainsKey("logo") ? linkedKeywordFields["logo"] : null;
        link = linkedKeywordFields.ContainsKey("www") ? linkedKeywordFields["www"].Values[0] : null;
    }
}

@Html.Partial("~/Views/Partials/CrumbsLight.cshtml")

<section class="brand-summary izotaup" itemscope itemtype="http://schema.org/Brand">
	@Html.Partial("~/Views/Partials/HeaderSimple.cshtml")
	<div class="row-fluid visible-desktop">
		<div class="span12 ">
			@Html.Image(banner, new { @class = "shaded" })
		</div>
	</div>
	<div class="row-fluid brand-logo-container">
		<div class="span6 text-center">
		@if (logo != null)
		{
			@Html.Image(logo, new { @class = "logo" })
		}
		</div>
		<div class="span6 brandbody">
			@if (body != null)
			{
				for (var i = 0; i < body.Count; i++)
				{
					@body[i].ResolveRichText()
				}
			}
		</div>
        <div class="brand-link">
        		@if (link != null)
		{
			<a href="@link" target="_blank">@link.Replace("http://", "")</a>
		}
        </div>
	</div>
	<div class="row-fluid divider">
		<div class="span12"></div>
	</div>
    <div class="row-fluid">
		@if (related != null)
		{
		<div class="pods">
		    @for (var i = 0; i < related.Count; i++)
		    {
                //if (i < 4)
                //{
			        var current = related[i];

			        //if (current.ContainsKey("linkComponent"))
			        //{
				    //    @Html.Partial("~/Views/Partials/PodGeneric.cshtml", current["linkComponent"].LinkedComponentValues[0])
			        //}
			        //else
			        //{
                        if (current.ContainsKey("boolNewWindow"))
                        {
                            target = (current["boolNewWindow"].Values[0] == "True") ? "_blank" : "_top";
                        }
                        else
                        {
                            target = "_top";
                        }
                        
						String classy = String.Empty;
						
						if((i + 1) % 3 == 0) {
							classy = "clearleft-tablet";
						}

                        String linkurl = current.ContainsKey("linkURL") ? current["linkURL"].Values[0] : "#";
						if (current.ContainsKey("linkComponent"))
						{
							linkurl = current["linkComponent"].LinkedComponentValues[0].GetResolvedUrl();
						}                        
                        if (!linkurl.StartsWith("http://") && linkurl != "#")
                        {
                            <!-- @linkurl.AddApplicationRoot() -->
                            linkurl = Url.Content(linkurl.AddApplicationRoot());
                        }
                        
			            <div class="span3 pod @classy">
			                @if (current.ContainsKey("linkImage")) {
			                    <div class="image">
			                        <a href="@linkurl" target="@target">@Html.Image(current["linkImage"])</a>
			                    </div>
                            }
			                <div class="content">
			                    <div class="body">
			                        <p><a href="@linkurl" target="@target">@current["linkTitle"].Values[0]</a></p>
			                    </div>
			                </div>
			            </div>
                    //}
                //}
            }
			</div>
        }
    </div>
</section>